

<mat-card class="contentWrapper">
  <ng-container *ngIf="contentSubject | async as contentObject; else loading">
      <!-- if the content exists and you're authorized, the contnet will be a valid object; else not. -->
      <ng-container *ngIf="contentObject && contentObject.content; else unavailable">
        <mat-card-title>{{contentObject.title}}</mat-card-title>
        <mat-card-subtitle *ngIf="contentObject.access !== AccessRoles.everyone">Access group: {{contentObject.access}}</mat-card-subtitle>

        <div *ngIf="(authService.getUser() | async) && authService.isUserOfRole(AccessRoles.admin)" class="pageControls">
          <button mat-icon-button [matMenuTriggerFor]="pageControls">
            <mat-icon>more_vert</mat-icon>
          </button>
          <mat-menu #pageControls="matMenu" xPosition="before">
            <button mat-menu-item (click)="editPage()">
              <mat-icon>mode_edit</mat-icon> Edit
            </button>
            <button mat-menu-item (click)="deletePage()" [disabled]="contentObject.route === 'home'">
              <mat-icon>delete</mat-icon> Delete
            </button>
          </mat-menu>
        </div>

        <mat-card-content>
          <!-- THE ACTUAL CONTENT WILL BE RENDERED INSIDE HERE!!! -->
          <div #content class="content" [innerHTML]="san.bypassSecurityTrustHtml(contentObject.content)">
          </div>


          <div class="info" *ngIf="contentObject.route !== 'home'">
            <div>
              Updated by: {{contentObject.updatedBy.username}}, <span matTooltip="{{ contentObject.updatedAt | dfnsDistanceInWordsToNow }} ago" matTooltipPosition="above">
                {{ contentObject.updatedAt | date:'dd. MMM yyyy, HH:mm' }}
              </span>
            </div>
            <div>
              Written by: {{contentObject.createdBy.username}}, <span matTooltip="{{ contentObject.createdAt | dfnsDistanceInWordsToNow }} ago" matTooltipPosition="above">
                {{ contentObject.createdAt | date:'dd. MMM yyyy, HH:mm' }}
              </span>
            </div>
          </div>
        </mat-card-content>
      </ng-container>

      <!-- The content is unavailable or doesn't exist -->
      <ng-template #unavailable>
        <mat-card-title>Page at /{{ (route.url | async).join('/') }}</mat-card-title>
        <mat-card-subtitle>Page not available</mat-card-subtitle>
        <mat-card-content>
          <div class="content">
            <p>
              This page seems to be unavailable at the moment. Maybe you're not authorized, or maybe the network is flaky.
              It could even be that the page you attempted to access does not actually exist.
            </p>
            <p>
              Either way; it wasn't meant to be, right now.
            </p>
          </div>
        </mat-card-content>
      </ng-template>

  </ng-container>

  <ng-template #loading>
    <mat-card-content>
      <mat-progress-bar mode="indeterminate" ngClass="loading"></mat-progress-bar>
    </mat-card-content>
  </ng-template>
</mat-card>
